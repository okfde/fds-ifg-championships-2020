{"version":3,"sources":["main.js"],"names":["teams","bw","captain","firstName","state","by","be","bb","hb","hh","he","mv","ni","nw","rp","sl","sn","st","sh","th","rounds","title","matches","number","team1","team2","request","callback","betPrefix","window","alert","data","XMLHttpRequest","open","betURL","onerror","setRequestHeader","document","querySelector","value","this","status","imagePath","JSON","parse","response","loggedIn","minBettableMatchNumber","send","imageSrc","userBets","loading","createTournament","placeBet","dataset","team","renderBetByMatch","matchNumber","match","Array","from","betStar","getBet","createRounds","concat","length","rootContainer","innerHTML","result","i","l","round","matchesArr","push","createTeam","winner","renderBet","createMatches","betStars","forEach","addEventListener","key","props","isWinner","lastName","img","charAt","querySelectorAll","bettable","r","user","getElementById","src","replace"],"mappings":"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","file":"main.js","sourcesContent":["(function(){\n\nconst teams = {\n  bw: {\n    captain: {\n      firstName: 'Winfried',\n      lastName: 'Kretschmann'\n    },\n    state: 'Baden-Württemberg',\n    img: 'kretschmann.png'\n  },\n  by: {\n    captain: {\n      firstName: 'Markus',\n      lastName: 'Söder'\n    },\n    state: 'Bayern',\n    img: 'soeder.png'\n  },\n  be: {\n    captain: {\n      firstName: 'Michael',\n      lastName: 'Müller'\n    },\n    state: 'Berlin',\n    img: 'mueller.png'\n  },\n  bb: {\n    captain: {\n      firstName: 'Dietmar',\n      lastName: 'Woidke'\n    },\n    state: 'Brandenburg',\n    img: 'woidke.png'\n  },\n  hb: {\n    captain: {\n      firstName: 'Andreas',\n      lastName: 'Bovenschulte'\n    },\n    state: 'Bremen',\n    img: 'bovenschulte.png'\n  },\n  hh: {\n    captain: {\n      firstName: 'Peter',\n      lastName: 'Tschentscher'\n    },\n    state: 'Hamburg',\n    img: 'tschentscher.png'\n  },\n  he: {\n    captain: {\n      firstName: 'Volker',\n      lastName: 'Bouffier'\n    },\n    state: 'Hessen',\n    img: 'bouffier.png'\n  },\n  mv: {\n    captain: {\n      firstName: 'Manuela',\n      lastName: 'Schwesig'\n    },\n    state: 'Mecklenburg-Vorpommern',\n    img: 'schwesig.png'\n  },\n  ni: {\n    captain: {\n      firstName: 'Stephan',\n      lastName: 'Weil'\n    },\n    state: 'Niedersachsen',\n    img: 'weil.png'\n  },\n  nw: {\n    captain: {\n      firstName: 'Armin',\n      lastName: 'Laschet'\n    },\n    state: 'Nordrhein-Westfalen',\n    img: 'laschet.png'\n  },\n  rp: {\n    captain: {\n      firstName: 'Malu',\n      lastName: 'Dreyer'\n    },\n    state: 'Rheinland-Pfalz',\n    img: 'dreyer.png'\n  },\n  sl: {\n    captain: {\n      firstName: 'Tobias',\n      lastName: 'Hans'\n    },\n    state: 'Saarland',\n    img: 'hans.png'\n  },\n  sn: {\n    captain: {\n      firstName: 'Michael',\n      lastName: 'Kretschmer'\n    },\n    state: 'Sachsen',\n    img: 'kretschmer.png'\n  },\n  st: {\n    captain: {\n      firstName: 'Reiner',\n      lastName: 'Haseloff'\n    },\n    state: 'Sachsen-Anhalt',\n    img: 'haseloff.png'\n  },\n  sh: {\n    captain: {\n      firstName: 'Daniel',\n      lastName: 'Günther'\n    },\n    state: 'Schleswig-Holstein',\n    img: 'guenther.png'\n  },\n  th: {\n    captain: {\n      firstName: 'Bodo',\n      lastName: 'Ramelow'\n    },\n    state: 'Thüringen',\n    img: 'ramelow.png'\n  },\n}\n\nconst rounds = [\n  {\n    title: 'Runde 1',\n    matches: [\n      {\n        number: 1,\n        team1: 'sh',\n        team2: 'st',\n        // winner: ''\n      },\n      {\n        number: 2,\n        team1: 'hb',\n        team2: 'mv',\n        // winner: ''\n      },\n      {\n        number: 3,\n        team1: 'rp',\n        team2: 'he',\n        // winner: ''\n      },\n      {\n        number: 4,\n        team1: 'be',\n        team2: 'bb',\n        // winner: ''\n      },\n      {\n        number: 5,\n        team1: 'nw',\n        team2: 'ni',\n        // winner: ''\n      },\n      {\n        number: 6,\n        team1: 'sn',\n        team2: 'by',\n        // winner: ''\n      },\n      {\n        number: 7,\n        team1: 'hh',\n        team2: 'bw',\n        // winner: ''\n      },\n      {\n        number: 8,\n        team1: 'sl',\n        team2: 'th',\n        // winner: ''\n      },\n    ]\n  },\n  {\n    title: 'Runde 2',\n    matches: [\n      // {\n      //   number: 9,\n      //   team1: '',\n      //   team2: '',\n      //   winner: ''\n      // },\n      // {\n      //   number: 10,\n      //   team1: '',\n      //   team2: '',\n      //   winner: ''\n      // },\n      // {\n      //   number: 11,\n      //   team1: '',\n      //   team2: '',\n      //   winner: ''\n      // },\n      // {\n      //   number: 12,\n      //   team1: '',\n      //   team2: '',\n      //   winner: ''\n      // },\n    ]\n  },\n  {\n    title: 'Halbfinale',\n    matches: [\n      // {\n      //   number: 13,\n      //   team1: '',\n      //   team2: '',\n      //   winner: ''\n      // },\n      // {\n      //   number: 14,\n      //   team1: '',\n      //   team2: '',\n      //   winner: ''\n      // },\n    ]\n  },\n  {\n    title: 'Finale',\n    matches: [\n      // {\n      //   number: 15,\n      //   team1: '',\n      //   team2: '',\n      //   winner: ''\n      // },\n    ]\n  },\n]\n\nconst betURL = '/tippspiel/'\nconst betPrefix = 'fds_meisterschaften_2020_'\n\nfunction getBet(callback, data) {\n  var request = new XMLHttpRequest();\n  request.open(data ? 'POST' : 'GET', betURL, true);\n  if (data) {\n    request.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded; charset=UTF-8');\n    request.setRequestHeader('X-CSRFToken', document.querySelector('[name=csrfmiddlewaretoken]').value)\n  }\n  request.setRequestHeader(\"X-Requested-With\", \"XMLHttpRequest\");\n  request.onload = function() {\n    if (this.status >= 200 && this.status < 400) {\n      // Success!\n      var data = JSON.parse(this.response);\n      callback(data)\n    } else {\n      // We reached our target server, but it returned an error\n      window.alert('Error')\n    }\n  };\n  request.onerror = function() {\n    window.alert('Error')\n  };\n  request.send(data);\n}\n\nvar imagePath = \"img/\"\nvar loggedIn = false\nvar userBets = {}\nvar loading = false\nvar minBettableMatchNumber = 1\n\nrounds.forEach(r => {\n  if (r.matches.length > 0) {\n    minBettableMatchNumber = r.matches[0].number\n  }\n})\n\nfunction init () {\n  const imageSrc = rootContainer.querySelector('img').src\n  imagePath = imageSrc.replace('spinner.gif', '')\n  loggedIn = document.getElementById('userDropdownMenu') !== null\n\n  if (!loggedIn) {\n    createTournament()\n  } else {\n    getBet(function (data) {\n      userBets = data.user || {}\n      createTournament()\n    })\n  }\n}\n\nfunction placeBet () {\n  const el = this\n  const team = el.dataset.team\n  const matchNumber = el.dataset.match\n\n  if (!loggedIn) {\n    window.alert(\"Sie müssen eingeloggt sein, um am Tippspiel teilzunehmen.\")\n    return\n  }\n  if (loading) {\n    window.alert(\"Ihre letzte Aktion wird noch verarbeitet.\")\n    return\n  }\n\n  userBets[betPrefix + matchNumber] = team\n  loading = true\n  renderBetByMatch(matchNumber, true)\n\n  getBet(function (data) {\n    userBets = data.user || {}\n    loading = false\n    renderBetByMatch(matchNumber, false)\n  }, `match=${matchNumber}&bet=${team}`)\n\n}\n\n\nfunction createTournament () {\n  rootContainer.innerHTML =`\n    <div class=\"tournament-bracket tournament-bracket--rounded\">\n      ${createRounds(rounds)}\n    </div>\n    `\n  const betStars = rootContainer.querySelectorAll('.tournament-bracket__tip a')\n  Array.from(betStars).forEach((betStar) => {\n    betStar.addEventListener('click', placeBet)\n  })\n}\n\nfunction createRounds (rounds) {\n  let result = ''\n  for (let i = 0, l = rounds.length; i < l; i++) {\n    result += createRound(rounds[i], i + 1)\n  }\n  return result\n}\n\nfunction createRound (round) {\n  return `\n  <div class=\"tournament-bracket__round\">\n    <h3 class=\"tournament-bracket__round-title\">${round.title}</h3>\n    ${round.matches && round.matches.length > 0 ? `\n    <ul class=\"tournament-bracket__list\">\n      ${createMatches(round.matches)}\n    </ul>\n    ` : ''}\n  </div>\n  `\n}\n\nfunction createMatches (matchesArr) {\n  let result = []\n  for (let i = 0, l = matchesArr.length; i < l; i++) {\n    result.push(createMatch(matchesArr[i]))\n  }\n  return result.join('')\n}\n\nfunction createMatch (match) {\n  const team1 = teams[match.team1]\n  const team2 = teams[match.team2]\n\n  return `\n  <li class=\"tournament-bracket__item\">\n    <div class=\"tournament-bracket__match\" tabindex=\"0\">\n      <table class=\"tournament-bracket__table\">\n        <tbody class=\"tournament-bracket__content\">\n          ${createTeam(match.team1, team1, match.winner === 'team1', match.number)}\n          ${createTeam(match.team2, team2, match.winner === 'team2', match.number)}\n        </tbody>\n      </table>\n    </div>\n  </li>\n  `\n}\n\nfunction createTeam (key, props, isWinner, matchNumber) {\n  const title = `${props.captain.firstName} ${props.captain.lastName} (${props.state})`\n  return `\n  <tr class=\"tournament-bracket__team\">\n    <td class=\"tournament-bracket__image\" title=\"${title}\"><img src=\"${imagePath}${props.img}\"></td>\n    <td class=\"tournament-bracket__label\" title=\"${title}\">\n      <span class=\"tournament-bracket__name\">${props.captain.firstName.charAt(0)}. ${props.captain.lastName}</span>&nbsp;<span class=\"tournament-bracket__token\" title=\"${props.state}\">(${key})</span>\n    </td>\n    <td class=\"tournament-bracket__result\" title=\"Gewinner\">${isWinner ? '🏆️&nbsp;' : ''}</td>\n    <td class=\"tournament-bracket__tip\">\n      ${ matchNumber >= minBettableMatchNumber ?\n        `<a href=\"#\" data-team=\"${key}\" data-match=\"${matchNumber}\">${renderBet(key, matchNumber, true)}</a>` :\n        renderBet(key, matchNumber, false)\n      }\n    </td>\n  </tr>\n  `\n}\n\nfunction renderBetByMatch (matchNumber, loading) {\n  const betStars = rootContainer.querySelectorAll(`.tournament-bracket__tip a[data-match=\"${matchNumber}\"]`)\n  Array.from(betStars).forEach((betStar) => {\n    if (loading) {\n      betStar.innerHTML = `<i class=\"fa fa-spinner\" aria-hidden=\"true\"></i>`\n    } else {\n      betStar.innerHTML = renderBet(betStar.dataset.team, matchNumber, true)\n    }\n  })\n}\n\nfunction renderBet (team, matchNumber, bettable) {\n  if (userBets) {\n    const betted = userBets[betPrefix + matchNumber] === team\n    if (betted) {\n      return `<i class=\"fa fa-star\" aria-hidden=\"true\"></i>`\n    }\n  }\n  if (bettable) {\n    return `<i class=\"fa fa-star-o\" aria-hidden=\"true\"></i>`\n  }\n  return ``\n}\n\nconst rootContainer = document.getElementById('tournament-visual')\ninit();\n\n}())"]}